var SC=SC||{},SC=SC||{};SC.chart||(SC.chart={}),SC.chart.pie=function(){"use strict";function t(e){t.reDrawChart(e)}function e(){function t(t){var a=d3.interpolate({startAngle:0*Math.PI,endAngle:0*Math.PI},t);return function(t){return e(a(t))}}var e=d3.svg.arc(),n=($(o).data("chart-type")||"pie",$(o).data("animation-type")||"exp-in-out"),r=$(o).data("animation-speed")||1200;h.HideLegend===!0?e.outerRadius(l/2.5).innerRadius(0):p/2>l?e.outerRadius(l/2.5).innerRadius(0):e.outerRadius(p/4.5).innerRadius(0);var d=v(a.values),u=i.selectAll(".arc").data(d).enter().append("g").attr("class","arc").each(function(t){isNaN(t.startAngle)&&(t.startAngle=0),isNaN(t.endAngle)&&(t.endAngle=0)});u.append("path").attr("d",e).style("fill",function(t,e){return g(e)}).transition().ease(n).duration(r).attrTween("d",t).style("cursor",function(t){return"other"!==t.data.url?"default":"pointer"})}var a,n,r,i,d,o,u,s,c,l=256,p=600,h={},f=["#256194","#0494d7","#8fb7e1","#a3cf5d","#7a9900","#d00a2d","#f15c21","#fcce07","#a743b3","#593d83","#65656a","#193b53"],g=d3.scale.ordinal().range(f),v=d3.layout.pie().sort(null).startAngle(0*Math.PI).endAngle(2*Math.PI).value(function(t){return t.values}),y=function(t){var e=d3.range(t.length),a=[];return e.forEach(function(e){a[e]={data:t[e]}}),a};return t.reDrawChart=function(t){u&&u.remove(),h.HideLegend===!0?n=p>l?l:p:(n=p/2>l?l:p/2,r=p-n),o=t,u=d3.select(t).append("div").attr("class","sc-pie-chart-container").attr("height",l),this.drawChart()},t.drawChart=function(){s=u.append("div").attr("class","sc-pie-chart").attr("width",n).attr("height",l),s.append("div").attr("class","sc-pie-chart-refresh-icon").style("display","none");var e=s.append("svg");return h.HideLegend!==!0?(c=u.append("div").attr("class","sc-pie-chart-key").style("width",r+"px").attr("height",l),void 0!==a&&a.values.length>0&&t.drawKey(c),t.drawPieChart(e),t):void 0},t.drawPieChart=function(t){i=t.attr("height",l).attr("width",n).append("g").attr("transform","translate("+n/2+","+l/2+")"),e()},t.drawKey=function(t){if(h.HideLegend!==!0){t.append("div").attr("class","sc-pie-chart-keyHeader").text(a.title);var e=y(a.values);d=t.append("div");var n=d.append("ul"),r=n.selectAll("li").data(e).enter().append("li").style("cursor",function(t){return"other"!==t.data.url?"default":"pointer"}),i=$(o).data("animation-type")||"exp-in-out",u=$(o).data("animation-speed")||1200,s=$(o).data("key-animation-type")||i,c=$(o).data("key-animation-speed")||u;r.append("div").transition().duration(c).ease(s).style("width","1.125em").style("height","1.125em").style("background-color",function(t,e){return f[e]});var l=r.append("div").text(function(t){return t.data.key}).style("opacity","0");l.transition().duration(c).ease(s).style("opacity","1")}},t.on=function(e,a){return a&&(i&&i.selectAll("path").on(e,a),d&&d.selectAll("li").on(e,a)),t},t.colors=function(e){return arguments.length?(f=e,g=d3.scale.ordinal().range(f),t):f},t.data=function(e){return a=e,t},t.height=function(e){return arguments.length?(e>0&&(l=e),t):l},t.width=function(e){return arguments.length?(p=e,t):p},t.updateData=function(n){return a=n,e(),t},t.options=function(e){return arguments.length?(h=$.extend(h,e),t):h},t.updateChart=function(){u&&(s&&s.remove(),c&&c.remove()),this.drawChart()},t};
